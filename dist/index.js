"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/store");const e=(t,e)=>{if(!Array.isArray(t.validators))return null;for(const r of t.validators)if("function"==typeof r)try{const s=r(e,t.control);if(null!=s)return s}catch(t){console.error("validator error",r,t)}return null};var r,s=new Uint8Array(16);function o(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(s)}var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function l(t){return"string"==typeof t&&i.test(t)}for(var n=[],a=0;a<256;++a)n.push((a+256).toString(16).substr(1));function d(t,e,r){var s=(t=t||{}).random||(t.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=s[i];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase();if(!l(r))throw TypeError("Stringified UUID is invalid");return r}(s)}const u={type:"string"};class c{constructor(e,r){var s,o;this.id=d(),this.validators=t.writable({validators:e,control:this}),this.meta=t.writable(null!==(s=Object.assign(Object.assign({},u),r))&&void 0!==s?s:{}),this.label=null!==(o=null==r?void 0:r.name)&&void 0!==o?o:""}setMeta(t){this.meta.set(t)}patchMeta(e){const r=t.get(this.meta);this.meta.set(Object.assign(Object.assign({},r),e))}setValidators(t){Array.isArray(t)&&t.length&&this.validators.set({validators:t,control:this})}}class h extends c{constructor(r,s=[],o){super(s,o),this.initial=r,this.value=t.writable(this.initial),this.touched=t.writable(!1),this.state=t.derived([this.value,this.touched,this.validators,this.meta],(([t,r,s,o],i)=>{const l=this.initial!==t,n=e(s,t);let a=!0,d=!1,u=o,c="control";null!=n&&n instanceof Promise?(d=!0,i({$error:null,$valid:a,$touched:r,$dirty:l,$pending:d,$meta:u,$type:c}),n.then((t=>{a=null==t,d=!1,i({$error:t,$valid:a,$touched:r,$dirty:l,$pending:d,$meta:u,$type:c})})).catch((t=>{a=!1,i({$error:{serverError:!0},$valid:a,$touched:r,$dirty:l,$pending:d,$meta:u,$type:c})}))):(a=null==n,i({$error:n,$valid:a,$touched:r,$dirty:l,$pending:d,$meta:u,$type:c}))}))}setTouched(t){this.touched.set(t)}child(){return null}reset(t){void 0!==t&&(this.initial=t),this.value.set(this.initial),this.touched.set(!1)}}const v=/^([^.[]+)\.?(.*)$/;const p=/^\[(\d+)\]\.?(.*)$/;const $=t=>null==t||""==`${t}`,m=/^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$/,b=/^\d*\.?\d+$/,g=/^\d+$/;exports.Control=h,exports.ControlArray=class extends c{constructor(r,s=[],o){super(s,o),this._controls=r,this.controlStore=t.writable(this._controls),this.touched=t.writable(!1),this.controls={subscribe:this.controlStore.subscribe},this.valueDerived=t.derived(this.controlStore,((e,r)=>t.derived(e.map((t=>t.value)),(t=>t)).subscribe(r))),this.childStateDerived=t.derived(this.controlStore,((e,r)=>t.derived(e.map((t=>t.state)),(t=>t)).subscribe(r))),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:e=>this.setValue(e(t.get(this.valueDerived)))},this.state=t.derived([this.valueDerived,this.childStateDerived,this.validators,this.touched],(([r,s,o,i])=>{const l={list:[]};let n=!0;l.$touched=i;for(let t=0,e=s.length;t<e;t++){const e=s[t];l.list[t]=e,n=n&&e.$valid,l.$touched=l.$touched||e.$touched||!1,l.$dirty=l.$dirty||e.$dirty}return l.$error=e(o,r),l.$valid=null==l.$error&&n,l.$meta=t.get(this.meta),l.$type="array",l}))}iterateControls(e){t.get(this.controlStore).forEach(e)}sortArray(e){const r=t.get(this.controlStore);let s=e.map((t=>t.id)).map((t=>r.find((e=>e.id===t))));s=s.filter((t=>void 0!==t)),this.controlStore.set(s)}setValue(t){this.iterateControls(((e,r)=>{const s=t&&t[r]||null;e.value.set(s)}))}setTouched(t){this.touched.set(t),this.iterateControls((e=>e.setTouched(t)))}pushControl(t){this.controlStore.update((e=>(e.push(t),e)))}addControlAt(t,e){this.controlStore.update((r=>(r.splice(t,0,e),r)))}removeControlAt(t){this.controlStore.update((e=>(e.splice(t,1),e)))}removeControl(t){this.controlStore.update((e=>e.filter((e=>e!==t))))}slice(t,e){this.controlStore.update((r=>r.slice(t,e)))}child(e){const[r,s,o]=e.match(p)||[],i=t.get(this.controlStore),l=null!=s&&i[+s]||null;return l?o?l.child(o):l:null}reset(t){this.iterateControls(((e,r)=>{const s=t&&t[r]||null;e.reset(s)}))}},exports.ControlBase=c,exports.ControlGroup=class extends c{constructor(r,s=[],o){super(s,o),this.controlStore=t.writable({}),this.controls={subscribe:this.controlStore.subscribe},this.valueDerived=t.derived(this.controlStore,((e,r)=>{const s=Object.keys(e),o=s.map((t=>e[t].value));return t.derived(o,(t=>t.reduce(((t,e,r)=>(t[s[r]]=e,t)),{}))).subscribe(r)})),this.touched=t.writable(!1),this.childStateDerived=t.derived(this.controlStore,((e,r)=>{const s=Object.keys(e),o=s.map((t=>e[t].state));return t.derived(o,(t=>t.reduce(((t,e,r)=>(t[s[r]]=e,t)),{}))).subscribe(r)})),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:e=>this.setValue(e(t.get(this.valueDerived)))},this.state=t.derived([this.valueDerived,this.childStateDerived,this.validators,this.touched,this.meta],(([t,r,s,o,i])=>{const l={};let n=!0,a=o,d=!1,u=!1,c=i;for(const t of Object.keys(r)){const e=l[t]=r[t];n=n&&e.$valid,a=a||e.$touched,d=d||e.$dirty,u=u||e.$pending}const h=e(s,t),v=null==h&&n;return Object.assign({$error:h,$valid:v,$touched:a,$dirty:d,$pending:u,$meta:c,$type:"group"},l)})),this.controlStore.set(r)}iterateControls(e){const r=t.get(this.controlStore);Object.entries(r).forEach(e)}setValue(t){this.iterateControls((([e,r])=>{var s;const o=null!==(s=t&&t[e])&&void 0!==s?s:null;r.value.set(o)}))}patchValue(e){const r=t.get(this.valueDerived);this.setValue(Object.assign(Object.assign({},r),e))}addControl(t,e){this.controlStore.update((r=>(r[t]=e,r)))}removeControl(t){this.controlStore.update((e=>(delete e[t],e)))}setTouched(t){this.iterateControls((([e,r])=>{r.setTouched(t)})),this.touched.set(t)}child(e){const[r,s,o]=e.match(v)||[],i=t.get(this.controlStore),l=s&&i[s]||null;return l?o?l.child(o):l:null}reset(t){this.iterateControls((([e,r])=>{const s=t&&t[e]||void 0;r.reset(s)}))}},exports.controlClasses=(e,r)=>{if(!(r instanceof h))throw new Error("must be used with a Control class");const s=e.classList,o=r.state.subscribe((t=>{t.$error?(s.add("invalid"),s.remove("valid")):(s.add("valid"),s.remove("invalid")),t.$dirty?(s.add("dirty"),s.remove("pristine")):(s.add("pristine"),s.remove("dirty")),t.$touched?s.add("touched"):s.remove("touched")})),i=["blur","focusout"],l=()=>{t.get(r.state).$touched||r.setTouched(!0)};return i.forEach((t=>e.addEventListener(t,l))),{destroy(){i.forEach((t=>e.removeEventListener(t,l))),o()}}},exports.decimal=t=>$(t)||!isNaN(+t)&&b.test(`${t}`)?null:{decimal:!0},exports.email=t=>$(t)||m.test(t)?null:{email:!0},exports.integer=t=>$(t)||!isNaN(+t)&&g.test(`${t}`)?null:{integer:!0},exports.max=t=>e=>$(e)||!isNaN(+e)&&(null==t||e<=t)?null:{max:t},exports.maxLength=t=>e=>$(e)||null==t||`${e}`.trim().length<=t?null:{maxLength:t},exports.min=t=>e=>$(e)||!isNaN(+e)&&(null==t||e>=t)?null:{min:t},exports.minLength=t=>e=>$(e)||null==t||`${e}`.trim().length>=t?null:{minLength:t},exports.number=t=>$(t)||!isNaN(+t)?null:{number:!0},exports.pattern=t=>e=>$(e)||null==t||t.test(e)?null:{pattern:`${t}`},exports.required=t=>""!==(null!=t&&!1!==t?`${t}`.trim():"")?null:{required:!0};
//# sourceMappingURL=index.js.map
