import{writable as t,get as e,derived as s}from"svelte/store";const r=(t,e)=>{if(!Array.isArray(t.validators))return null;for(const s of t.validators)if("function"==typeof s)try{const r=s(e,t.control);if(null!=r)return r}catch(t){console.error("validator error",s,t)}return null};var o,i=new Uint8Array(16);function n(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(i)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function l(t){return"string"==typeof t&&a.test(t)}for(var h=[],c=0;c<256;++c)h.push((c+256).toString(16).substr(1));function u(t,e,s){var r=(t=t||{}).random||(t.rng||n)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){s=s||0;for(var o=0;o<16;++o)e[s+o]=r[o];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase();if(!l(s))throw TypeError("Stringified UUID is invalid");return s}(r)}const d={type:"string"};class p{constructor(e,s){var r,o;this.id=u(),this.currentState=null,this.propagateChanges=!0,this.validators=t({validators:e,control:this}),this.meta=t(null!==(r=Object.assign(Object.assign({},d),s))&&void 0!==r?r:{}),this.label=null!==(o=null==s?void 0:s.name)&&void 0!==o?o:""}setMeta(t){this.meta.set(t)}patchMeta(t){const s=e(this.meta);this.meta.set(Object.assign(Object.assign({},s),t))}setValidators(t){Array.isArray(t)&&t.length&&this.validators.set({validators:t,control:this})}}class v extends p{constructor(e,o=[],i){super(o,i),this.initial=e,this.value=t(this.initial),this.touched=t(!1),this.state=s([this.value,this.touched,this.validators,this.meta],(([t,e,s,o],i)=>{const n=this.initial!==t,a=r(s,t);let l=!0,h=!1,c=o,u="control";null!=a&&a instanceof Promise?(h=!0,i({$error:null,$valid:l,$touched:e,$dirty:n,$pending:h,$meta:c,$type:u}),a.then((t=>{l=null==t,h=!1,i({$error:t,$valid:l,$touched:e,$dirty:n,$pending:h,$meta:c,$type:u})})).catch((t=>{l=!1,i({$error:{serverError:!0},$valid:l,$touched:e,$dirty:n,$pending:h,$meta:c,$type:u})}))):(l=null==a,i({$error:a,$valid:l,$touched:e,$dirty:n,$pending:h,$meta:c,$type:u}))}))}setTouched(t){this.touched.set(t)}child(){return null}reset(t){void 0!==t&&(this.initial=t),this.value.set(this.initial),this.touched.set(!1)}}const $=/^([^.[]+)\.?(.*)$/;class g extends p{constructor(o,i=[],n){super(i,n),this.controlStore=t({}),this.controls={subscribe:this.controlStore.subscribe},this.valueDerived=s(this.controlStore,((t,e)=>{const r=Object.keys(t),o=r.map((e=>t[e].value));return s(o,(t=>t.reduce(((t,e,s)=>(t[r[s]]=e,t)),{}))).subscribe(e)})),this.touched=t(!1),this.childStateDerived=s(this.controlStore,((t,e)=>{const r=Object.keys(t),o=r.map((e=>t[e].state));return s(o,(t=>t.reduce(((t,e,s)=>(t[r[s]]=e,t)),{}))).subscribe(e)})),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:t=>this.setValue(t(e(this.valueDerived)))},this.state=s([this.valueDerived,this.childStateDerived,this.validators,this.touched,this.meta],(([t,e,s,o,i])=>{if(!this.propagateChanges&&null!==this.currentState)return this.currentState;console.log("propagateState");const n={};let a=!0,l=o,h=!1,c=!1,u=i;for(const t of Object.keys(e)){const s=n[t]=e[t];a=a&&s.$valid,l=l||s.$touched,h=h||s.$dirty,c=c||s.$pending}const d=r(s,t),p=null==d&&a;let v=Object.assign({$error:d,$valid:p,$touched:l,$dirty:h,$pending:c,$meta:u,$type:"group"},n);return this.currentState=v,v})),this.controlStore.set(o)}iterateControls(t){const s=e(this.controlStore);Object.entries(s).forEach(t)}setValue(t){this.iterateControls((([e,s])=>{var r;const o=null!==(r=t&&t[e])&&void 0!==r?r:null;s.value.set(o)}))}patchValue(t){const s=e(this.valueDerived);this.setValue(Object.assign(Object.assign({},s),t))}setControls(t){this.controlStore.set(t)}patchControls(t){const s=e(this.controlStore);this.setControls(Object.assign(Object.assign({},s),t))}addControls(t,e){e&&!1===e.propagateChanges&&(this.propagateChanges=!1),this.controlStore.update((e=>(t.forEach((({key:t,control:s})=>{e[t]=s})),e))),this.propagateChanges=!0}addControl(t,e,s){s&&!1===s.propagateChanges&&(this.propagateChanges=!1),this.controlStore.update((s=>(s[t]=e,s))),this.propagateChanges=!0}removeControl(t,e){e&&!1===e.propagateChanges&&(this.propagateChanges=!1),this.controlStore.update((e=>(delete e[t],e))),this.propagateChanges=!0}setTouched(t){this.iterateControls((([e,s])=>{s.setTouched(t)})),this.touched.set(t)}child(t){const[s,r,o]=t.match($)||[],i=e(this.controlStore),n=r&&i[r]||null;return n?o?n.child(o):n:null}reset(t){this.iterateControls((([e,s])=>{const r=t&&t[e]||void 0;s.reset(r)}))}}const m=/^\[(\d+)\]\.?(.*)$/;class b extends p{constructor(o,i=[],n){super(i,n),this._controls=o,this.controlStore=t(this._controls),this.touched=t(!1),this.controls={subscribe:this.controlStore.subscribe},this.valueDerived=s(this.controlStore,((t,e)=>s(t.map((t=>t.value)),(t=>t)).subscribe(e))),this.childStateDerived=s(this.controlStore,((t,e)=>s(t.map((t=>t.state)),(t=>t)).subscribe(e))),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:t=>this.setValue(t(e(this.valueDerived)))},this.state=s([this.valueDerived,this.childStateDerived,this.validators,this.touched],(([t,s,o,i])=>{const n={list:[]};let a=!0;n.$touched=i;for(let t=0,e=s.length;t<e;t++){const e=s[t];n.list[t]=e,a=a&&e.$valid,n.$touched=n.$touched||e.$touched||!1,n.$dirty=n.$dirty||e.$dirty}return n.$error=r(o,t),n.$valid=null==n.$error&&a,n.$meta=e(this.meta),n.$type="array",n}))}iterateControls(t){e(this.controlStore).forEach(t)}sortArray(t){const s=e(this.controlStore);let r=t.map((t=>t.id)).map((t=>s.find((e=>e.id===t))));r=r.filter((t=>void 0!==t)),this.controlStore.set(r)}setValue(t){this.iterateControls(((e,s)=>{const r=t&&t[s]||null;e.value.set(r)}))}setTouched(t){this.touched.set(t),this.iterateControls((e=>e.setTouched(t)))}pushControl(t){this.controlStore.update((e=>(e.push(t),e)))}addControlAt(t,e){this.controlStore.update((s=>(s.splice(t,0,e),s)))}removeControlAt(t){this.controlStore.update((e=>(e.splice(t,1),e)))}removeControl(t){this.controlStore.update((e=>e.filter((e=>e!==t))))}slice(t,e){this.controlStore.update((s=>s.slice(t,e)))}child(t){const[s,r,o]=t.match(m)||[],i=e(this.controlStore),n=null!=r&&i[+r]||null;return n?o?n.child(o):n:null}reset(t){this.iterateControls(((e,s)=>{const r=t&&t[s]||null;e.reset(r)}))}}const y=(t,s)=>{if(!(s instanceof v))throw new Error("must be used with a Control class");const r=t.classList,o=s.state.subscribe((t=>{t.$error?(r.add("invalid"),r.remove("valid")):(r.add("valid"),r.remove("invalid")),t.$dirty?(r.add("dirty"),r.remove("pristine")):(r.add("pristine"),r.remove("dirty")),t.$touched?r.add("touched"):r.remove("touched")})),i=["blur","focusout"],n=()=>{e(s.state).$touched||s.setTouched(!0)};return i.forEach((e=>t.addEventListener(e,n))),{destroy(){i.forEach((e=>t.removeEventListener(e,n))),o()}}},f=t=>null==t||""==`${t}`,S=t=>""!==(null!=t&&!1!==t?`${t}`.trim():"")?null:{required:!0},C=/^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$/,j=t=>f(t)||C.test(t)?null:{email:!0},D=t=>e=>f(e)||null==t||`${e}`.trim().length>=t?null:{minLength:t},V=t=>e=>f(e)||null==t||`${e}`.trim().length<=t?null:{maxLength:t},O=t=>f(t)||!isNaN(+t)?null:{number:!0},A=/^\d*\.?\d+$/,E=t=>f(t)||!isNaN(+t)&&A.test(`${t}`)?null:{decimal:!0},N=/^\d+$/,w=t=>f(t)||!isNaN(+t)&&N.test(`${t}`)?null:{integer:!0},T=t=>e=>f(e)||!isNaN(+e)&&(null==t||e>=t)?null:{min:t},x=t=>e=>f(e)||!isNaN(+e)&&(null==t||e<=t)?null:{max:t},L=t=>e=>f(e)||null==t||t.test(e)?null:{pattern:`${t}`};export{v as Control,b as ControlArray,p as ControlBase,g as ControlGroup,y as controlClasses,E as decimal,j as email,w as integer,x as max,V as maxLength,T as min,D as minLength,O as number,L as pattern,S as required};
//# sourceMappingURL=index.mjs.map
